<?xml version="1.0" encoding="utf-8" ?>
<Project ToolsVersion="4.0"
         xmlns="http://schemas.microsoft.com/developer/msbuild/2003"
         TreatAsLocalProperty="GeneratedAssets">

    <!-- 1. Exporting assets with msbuild task -->

    <Target Name="AssetMan"
            BeforeTargets="BeforeBuild">

        <Message Text="AssetMan is exporting assets..." />
        <Message Text="AssetManCliBasePath: $(AssetManCliBasePath)"/>
        <Message Text="AssetManCliPath: $(AssetManCliPath)"/>
        <Message Text="TargetFrameworkIdentifier: $(TargetFrameworkIdentifier)"/>

        <ExportAssets Debug="$(DebugAssetMan)"
                      AssetManCliPath="$(AssetManCliPath)">
            <Output TaskParameter="GeneratedAssets"
                    PropertyName="GeneratedAssets" />
        </ExportAssets>

        <Message Text="AssetMan exported assets." />
    </Target>

    <!-- 3. Include generated files in project -->

    <Target Name="IncludeAndroidAssets"
            AfterTargets="AssetMan"
            Condition=" '$(TargetFrameworkIdentifier)' == 'MonoAndroid' OR '$(TargetFrameworkIdentifier)' == 'MonoDroid' ">
        <Message Text="Including Android resources $(GeneratedAssets)" />

        <ItemGroup>
            <AndroidResource Include="$(GeneratedAssets)">
                <Visible>false</Visible>
            </AndroidResource>
        </ItemGroup>
    </Target>

    <Target Name="IncludeiOSAssets"
            AfterTargets="AssetMan"
            Condition=" '$(TargetFrameworkIdentifier)' == 'Xamarin.iOS' ">
        <Message Text="Including iOS resources $(GeneratedAssets)" />

        <ItemGroup>
            <ImageAsset Include="$(GeneratedAssets)">
                <Visible>false</Visible>
            </ImageAsset>
        </ItemGroup>
    </Target>

    <Target Name="IncludeUWPAssets"
            AfterTargets="AssetMan"
            Condition=" '$(TargetPlatformIdentifier)' == 'UAP' ">
        <Message Text="Including UWP resources $(GeneratedAssets)" />

        <ItemGroup>
            <Content Include="$(GeneratedAssets)">
                <Visible>false</Visible>
            </Content>
        </ItemGroup>
    </Target>

</Project>
